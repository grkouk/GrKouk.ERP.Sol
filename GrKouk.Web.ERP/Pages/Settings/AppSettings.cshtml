@page
@model AppSettingsModel

@{
    ViewData["Title"] = "Application Settings";
}

@section MyCss
{
    <link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/material.css"/>
}

<div class="container">
    <form method="post">
        <fieldset id="thisForm">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-row">
                <div class="form-group col-md-3">
                    <label asp-for="ItemVm[0].Code" class="control-label" small>All Companies Setting</label>
                    <select asp-for="ItemVm[0].Code" class="form-control form-control-sm small" asp-items="ViewBag.CompanyId"></select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-10">
                    <label class="control-label" small>Sum Of Material Buys Definition</label>
                    <div class="input-group input-group-sm">
                        <input id="BuyMaterialsValue" asp-for="ItemVm[1].Value" disabled/>

                        <div class="input-group-append" id="button-addon4">
                            <button class="btn btn-outline-secondary" data-toggle="modal" data-target="#itemSelector" data-selectorType="BuyMaterialsSettings" type="button">...</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-primary btn-sm" id="saveForm"/>
            </div>
        </fieldset>
    </form>
</div>
<!-- Modal Item selector -->
<div class="modal fade" id="itemSelector" tabindex="-1" role="dialog" aria-labelledby="itemsModalLabel" aria-hidden="true" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" style="overflow-y: scroll; max-height:75%;  margin-top: 50px; margin-bottom:50px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="container-fluid">
                    <div class="form-row">
                        <div class="col-6">
                            <p class="modal-title font-weight-bold" id="itemsModalLabel">Selector</p>
                        </div>
                        <div class="col-6 text-right">

                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-body ">
                <div class="container-fluid">

                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <ejs-multiselect id="test" dataSource="@ViewBag.CompaniesListJs" placeholder="Select Companies" mode="CheckBox"
                                             showDropDownIcon="true"
                                             showSelectAll="true" selectAllText="Select All" unSelectAllText="unSelect All">
                                <e-multiselect-fields text="Title" value="Value"></e-multiselect-fields>
                            </ejs-multiselect>
                            @* <select class="selectpicker form-control form-control-sm small " id="CompaniesList" multiple *@
                            @*         title="Companies" data-actions-box="true" data-selected-text-format="count > 1"> *@
                            @* </select> *@
                        </div>
                        <div class="form-group col-md-3" id="MaterialNatureTypesDiv">
                            <select class="selectpicker form-control form-control-sm small " id="MaterialNatureTypes" multiple
                                    title="Item Natures" data-actions-box="true" data-selected-text-format="count > 1">
                            </select>
                        </div>
                        <div class="form-group col-md-3" id="TransactorSelectorTypesDiv">
                            <select class="selectpicker form-control form-control-sm small " id="TransactorTypes" multiple
                                    title="Item Natures" data-actions-box="true" data-selected-text-format="count > 1">
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-10">
                            <input class="form-control form-control-sm" name="itemsSearchText" placeholder="Search text" type="text"/>

                        </div>
                        <div class="col-2">
                            <span class="spinner-border spinner-border-sm text-primary" id="SpinnerLoader" style="display: none"></span>
                        </div>

                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js"></script>
    <ejs-scripts></ejs-scripts>
    <script>
    $(document).ready(function() { 
        var getWarehouseItemNatureList = () => {
            var timeout;
            var pageIndex = 1;
            var uri = '/api/GrKoukInfoApi/GetSelectorMaterialNatures';
            $.ajax({
    contentType: 'application/json; charset=utf-8',
    dataType: 'json',
    type: 'GET',
    url: uri,
        beforeSend: function() {
            if (timeout) {
                clearTimeout(timeout);
            }
            timeout = setTimeout(function() {
                $("#loadMe").modal({
                    backdrop: "static",
                    keyboard: false,
                    show: true
                });
            },
            1000);
            },
    success: function(result) {
    $.each(result,
    function(index, item) {
    $('#MaterialNatureTypes').append($('<option></option>').attr('value', item.valueInt)
    .text(item.title));
    });
    $('#MaterialNatureTypes').selectpicker('refresh');
    },
    complete: function() {
    if (timeout) {
    clearTimeout(timeout);
    }
    $("#loadMe").modal("hide");
    setTimeout(function() {
    console.log('Checking for open modals');
    var isOpen = $('#loadMe').hasClass('show');
    if (isOpen) {
    console.log('There is an open Modal');
    $("#loadMe").modal("hide");
    } else {
    console.log('No open modal');
    }
    },
    2000);
    },
    error: function(e) {
    console.log(e);

    }
    });
    };
    var getTransactorTypeList = () => {
    var timeout;
    var pageIndex = 1;
    var uri = '/api/GrKoukInfoApi/GetSelectorTransactorTypes';
    $.ajax({
    contentType: 'application/json; charset=utf-8',
    dataType: 'json',
    type: 'GET',
    url: uri,
    beforeSend: function() {
    if (timeout) {
    clearTimeout(timeout);
    }
    timeout = setTimeout(function() {
    $("#loadMe").modal({
    backdrop: "static",
    keyboard: false,
    show: true
    });
    },
    1000);
    },
    success: function(result) {
    $.each(result,
    function(index, item) {
    $('#TransactorTypes').append($('<option></option>').attr('value', item.valueInt)
    .text(item.title));
    });
    $('#TransactorTypes').selectpicker('refresh');
    },
    complete: function() {
    if (timeout) {
    clearTimeout(timeout);
    }
    $("#loadMe").modal("hide");
    setTimeout(function() {
    console.log('Checking for open modals');
    var isOpen = $('#loadMe').hasClass('show');
    if (isOpen) {
    console.log('There is an open Modal');
    $("#loadMe").modal("hide");
    } else {
    console.log('No open modal');
    }
    },
    2000);
    },
    error: function(e) {
    console.log(e);

    }
    });
    };
    var getCompanyList = () => {
    var timeout;
    var pageIndex = 1;
    var uri = '/api/GrKoukInfoApi/GetSelectorCompanies';
    $.ajax({
    contentType: 'application/json; charset=utf-8',
    dataType: 'json',
    type: 'GET',
    url: uri,
    beforeSend: function() {
    if (timeout) {
    clearTimeout(timeout);
    }
    timeout = setTimeout(function() {
    $("#loadMe").modal({
    backdrop: "static",
    keyboard: false,
    show: true
    });
    },
    1000);
    },
    success: function(result) {
    $.each(result,
    function(index, item) {
    $('#CompaniesList')
    .append($('<option></option>').attr('value', item.value).text(item.title));
    });
    $('#CompaniesList').selectpicker('refresh');
    },
    complete: function() {
    if (timeout) {
    clearTimeout(timeout);
    }
    $("#loadMe").modal("hide");
    setTimeout(function() {
    console.log('Checking for open modals');
    var isOpen = $('#loadMe').hasClass('show');
    if (isOpen) {
    console.log('There is an open Modal');
    $("#loadMe").modal("hide");
    } else {
    console.log('No open modal');
    }
    },
    2000);
    },
    error: function(e) {
    console.log(e);

    }
    });
    };
    });

</script>
}